<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Bot</title>   
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">    
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/responsive.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</head>

<body>
    <div class="hero_area" style="height: 795px;">
        <header class="header_section">
            <div class="container">
                <div class="row">
                    <div class="col-md-5">
                        <br><a class="navbar-brand" href="./index.html">
                        <span>
                            Eduardo Fernández
                        </span>
                        </a>
                    </div>
                    <div class="col-md-7">
                        <div class="bg-custom" id="navbarSupportedContent">
                            <nav class="custom_nav-container navbar navbar-expand-lg navbar-light bg-light">
                                <div class="container">
                                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                                    <span class="navbar-toggler-icon"></span>
                                    </button>
                                    <div class="collapse navbar-collapse" id="navbarNav">
                                        <ul class="navbar-nav ms-auto">
                                            <li class="nav-item">
                                                <a class="nav-link active" aria-current="page" href="./index.html">Inicio</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" href="./galeria.html">Galeria</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" href="./test.html">Escribeme</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" href="./ubicacion.html">Ubicacion</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </nav>
                        </div>
                        
                    </div>
                </div>
            </div>
        </header>
        <section class="portfolio_section layout_padding text-center" style="height: 225px;">
            <h1><b>Quieres compartir algo conmigo</b></h1>
            <p>Escribeme !!!!!</p>
        </section>
        <section class="hero_area" style="height: 500px;">
            <div class="col-md-6 offset-md-3"><br><br>
                <form class="row g-4 needs-validation border border-dark border-3" id="contactForm">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="nombre" class="form-label">Nombre:</label>
                                    <input type="text" class="form-control" id="nombre" placeholder="Eduardo" title="Ingrese un nombre válido" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="apellido" class="form-label">Apellido</label>
                                    <input type="text" class="form-control" id="apellido" title="Ingrese su apellido" placeholder="Fernández" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="correo" class="form-label">Correo</label>
                                    <input type="email" class="form-control" id="correo" title="Ingrese una correo valido" placeholder="eduardo@gmail.com" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="contacto" class="form-label">Contacto</label>
                                    <input type="tel" class="form-control" id="contacto" placeholder="Ingrese el contacto" required>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="mensaje" class="form-label">Mensaje</label>
                                <textarea class="form-control" id="mensaje" rows="4" placeholder="Ingrese su mensaje" required></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 text-end">
                                <button class="btn btn-danger " type="submit">Guardar</button>
                            </div>
                            <div class="col-md-6 text-right">
                                <button class="btn btn-primary" type="button" id="limpiarCampos">Limpiar</button>
                            </div>
                        </div>
                        <br>
                    </div>
                </form>
            </div>
        </section>
    </div><br><br>

    <div class="modal fade text-dark " id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Edita todo lo que desees!!!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Formulario con los mismos campos del formulario original -->
                    <form class="row g-4 needs-validation " id="editForm">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="editNombre" class="form-label">Nombre:</label>
                                        <input type="text" class="form-control" id="editNombre" placeholder="Eduardo" title="Ingrese un nombre válido" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="editApellido" class="form-label">Apellido</label>
                                        <input type="text" class="form-control" id="editApellido" title="Ingrese su apellido" placeholder="Fernández" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="editCorreo" class="form-label">Correo</label>
                                        <input type="email" class="form-control" id="editCorreo" title="Ingrese una correo valido" placeholder="eduardo@gmail.com" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="editContacto" class="form-label">Contacto</label>
                                        <input type="tel" class="form-control" id="editContacto" placeholder="Ingrese el contacto" required>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="mb-3">
                                    <label for="editMensaje" class="form-label">Mensaje</label>
                                    <textarea class="form-control" id="editMensaje" rows="4" placeholder="Ingrese su mensaje" required></textarea>
                                </div>
                            </div>                          
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" id="guardarCambiosBtn">Guardar Cambios</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    

    <section>
        <div class="container">
            <div class="table-responsive">
                <table class="table table-striped table-bordered" id="">
                    <thead>
                        <tr class="text-center">
                            <th scope="col">Nombre</th>
                            <th scope="col">Apellido</th>
                            <th scope="col">Correo</th>
                            <th scope="col">Contacto</th>
                            <th class="w-50" scope="col">Mensaje</th>
                            <th class="w-25" scope="col">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <section class="info_section ">
        <div class="container">
            <div class="info_container">
                <div class="info_social">
                    <div class="d-flex justify-content-center">
                        <h4 class="">
                        Sigueme
                        </h4>
                    </div>
                    <div class="social_box">
                        <a href="https://www.facebook.com/eduardo.fernandezpena.90">
                        <img src="images/fb.png" alt="">
                        </a>
                        <a href="https://x.com/eduardfdz?s=20">
                        <img src="images/twitter.png" alt="">
                        </a>
                        <a href="https://www.instagram.com/edux.fxp3?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==">
                        <img src="images/instagram.png" alt="">
                        </a>
                        <a href="https://pin.it/1KhcOFIOq">
                        <img src="images/pinterest.png" alt="">
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <br>
    </section>
    <script>
        // Función para validar el nombre y apellido
        function validarNombreApellido(input, regex) {
            if (!regex.test(input.value.trim())) {
                input.setCustomValidity('El campo debe contener solo letras y espacios');
            } else {
                input.setCustomValidity('');
            }
        }
    
        // Función para validar el contacto
        function validarContacto(input, regex) {
            if (!regex.test(input.value.trim())) {
                input.setCustomValidity('El contacto debe contener exactamente 10 dígitos');
            } else {
                input.setCustomValidity('');
            }
        }
    
        // Escuchar cambios en el campo de nombre
        document.getElementById('nombre').addEventListener('input', function() {
            validarNombreApellido(this, /^[a-zA-Z\s]*$/);
        });
    
        // Escuchar cambios en el campo de apellido
        document.getElementById('apellido').addEventListener('input', function() {
            validarNombreApellido(this, /^[a-zA-Z\s]*$/);
        });
    
        // Escuchar cambios en el campo de contacto
        document.getElementById('contacto').addEventListener('input', function() {
            validarContacto(this, /^\d{10}$/);
        });
    </script>
    
    
    
    <script type="module">
        // Conexion
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, remove, update, get } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
    
        const firebaseConfig = {
            apiKey: "AIzaSyDunUUYaxITBW8TtcGgDYS384N-BgXpy0Y",
            authDomain: "test-50b62.firebaseapp.com",
            databaseURL: "https://test-50b62-default-rtdb.firebaseio.com",
            projectId: "test-50b62",
            storageBucket: "test-50b62.appspot.com",
            messagingSenderId: "1052110939946",
            appId: "1:1052110939946:web:d3271cff336b20f9e62053"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const contactForm = document.getElementById('contactForm');
        const tableBody = document.getElementById('tableBody');
        const messageRef = ref(db, 'messages');
    
        // Para guardar    
        contactForm.addEventListener('submit', (e) => {
            e.preventDefault(); // Evita que el formulario se envíe de forma predeterminada
    
            // Obtener valores del formulario
            const nombre = document.getElementById('nombre').value;
            const apellido = document.getElementById('apellido').value;
            const correo = document.getElementById('correo').value;
            const contacto = document.getElementById('contacto').value;
            const mensaje = document.getElementById('mensaje').value;
    
            // Guardar datos 
            const newMessageRef = push(ref(db, 'messages'));
            set(newMessageRef, {
                nombre: nombre,
                apellido: apellido,
                correo: correo,
                contacto: contacto,
                mensaje: mensaje,
            }).then(() => {
                alert('Mensaje enviado correctamente!');
                // Limpiamos los campos del formulario después de enviarlo
                document.getElementById('nombre').value='';
                document.getElementById('apellido').value='';
                document.getElementById('correo').value='';
                document.getElementById('contacto').value='';
                document.getElementById('mensaje').value='';
            }).catch((error) => {
                console.error('Error enviando mensaje:', error);
                alert('Hubo un error al enviar el mensaje. Por favor, inténtalo de nuevo más tarde.');
            });
        });
    
        // Obtenemos los datos del Firebase en una tabla 
        function displayData(snapshot) {
            tableBody.innerHTML = '';
            snapshot.forEach((childSnapshot) => {
                const childData = childSnapshot.val();
                const key = childSnapshot.key; // Obtener la clave de la instantánea
    
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${childData.nombre}</td>
                    <td>${childData.apellido}</td>
                    <td>${childData.correo}</td>
                    <td>${childData.contacto}</td>
                    <td>${childData.mensaje}</td>
                    <td class='text-center' wd='25'>
                        <button type="button" class="btn btn-warning btn-sm btn-modificar" data-bs-toggle="modal" data-bs-target="#exampleModal" data-key="${key}">
                            Modificar
                        </button>
                        <button type="button" class="btn btn-danger btn-sm" onclick="eliminarMensaje('${key}')">
                            Eliminar
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
    
            const modificarBtns = document.querySelectorAll('.btn-modificar');
            modificarBtns.forEach((btn) => {
                btn.addEventListener('click', () => {
                    const key = btn.getAttribute('data-key');
                    const messageRef = ref(db, `messages/${key}`);
                    get(messageRef).then((snapshot) => {
                        if (snapshot.exists()) {
                            const data = snapshot.val();
                            document.getElementById('editNombre').value = data.nombre;
                            document.getElementById('editApellido').value = data.apellido;
                            document.getElementById('editCorreo').value = data.correo;
                            document.getElementById('editContacto').value = data.contacto;
                            document.getElementById('editMensaje').value = data.mensaje;
                            document.getElementById('guardarCambiosBtn').setAttribute('data-key', key); // Agregar la clave al botón de guardar cambios
                        } else {
                            console.log("No data available");
                        }
                    }).catch((error) => {
                        console.error(error);
                    });
                });
            });
        }
    
        // Función para eliminar
        function eliminarMensaje(key) {
            if (confirm("¿Estás seguro de que deseas eliminar este mensaje?")) {
                remove(ref(db, `messages/${key}`))
                .then(() => {
                    alert('Mensaje eliminado correctamente.');
                })
                .catch((error) => {
                    console.error('Error eliminando mensaje:', error);
                    alert('Hubo un error al eliminar el mensaje. Por favor, inténtalo de nuevo más tarde.');
                });
            }
        }
    
        // Adjuntamos la función eliminarMensaje al objeto window para que esté disponible globalmente
        window.eliminarMensaje = eliminarMensaje;
    
        // Listener para el evento 'value'
        onValue(ref(db, 'messages'), (snapshot) => {
            displayData(snapshot);
        });
    
        // Función para actualizar los datos en la base de datos
        document.getElementById('guardarCambiosBtn').addEventListener('click', () => {
            const key = document.getElementById('guardarCambiosBtn').getAttribute('data-key');
            const messageRef = ref(db, `messages/${key}`);
            update(messageRef, {
                nombre: document.getElementById('editNombre').value,
                apellido: document.getElementById('editApellido').value,
                correo: document.getElementById('editCorreo').value,
                contacto: document.getElementById('editContacto').value,
                mensaje: document.getElementById('editMensaje').value,
            }).then(() => {
                alert('Cambios guardados correctamente.');
                const modal = new bootstrap.Modal(document.getElementById('exampleModal'));
                modal.hide();
            }).catch((error) => {
                console.error('Error actualizando mensaje:', error);
                alert('Hubo un error al guardar los cambios. Por favor, inténtalo de nuevo más tarde.');
            });
        });
    
        // Cerrar la ventana modal al hacer clic en "Cancelar"
        document.getElementById('cancelarCambiosBtn').addEventListener('click', () => {
            const modal = new bootstrap.Modal(document.getElementById('exampleModal'));
            modal.hide();
        });
    </script>
    
    
    
    
    
    
    
    
    
    
    <script src="u.js"></script>
</body>
</html>
